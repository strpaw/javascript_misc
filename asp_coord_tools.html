<!DOCTYPE html>
<html>
<body>
<div id="page">
  <div id="header" style="text-align: center; margin: 5px">
    <h2>Coordinates parser</h2>
  </div>

  <div id="left" style="float: left; margin: 5px">
    <h3>Plain text with coordinates:</h3>
    <textarea id="inputText" rows = "15" cols = "60">
    </textarea>
  </div>

  <div id="center" style="float: left; margin: 5px">
    <h3>Coordinate format:</h3>
    <select id="coordPatterns">
      <option value="LatLon">LatLon</option>
      <option value="LatSpaceLon">LatSpaceLon</option>
    </select>
    <br>
    <button type="button" onclick="extractCoordinates()">Get coordintes</button>
  </div>

  <div id="right" style="float: left; margin: 5px">
    <h3>Extracted coordinates:</h3>
    <textarea id="outputText" rows = "15" cols = "60">
    </textarea>
  </div>
</div>


<script>

var patternLatLon = /\d{4,}[NS]\d{5,}[EW]/g;  // Example: 5430N01930E
var patternLatSpaceLon = /\d{4,}[NS]\s\d{5,}[EW]/g;  //  Example: 543000N 0193000E

function getInputText() {
  var text = document.getElementById("inputText").value;
  var lines = text.split('\n');
  var inputText = lines.join('');
  return inputText;
}

function getCoordPattern() {
	var patterns = document.getElementById("coordPatterns");
  var i = patterns.selectedIndex;
  var option = patterns.options[i].value;
  var pattern;

  switch (option) {
    case "LatLon":
      pattern = patternLatLon;
      break;
    case "LatSpaceLon":
      pattern = patternLatSpaceLon;
  }
  return pattern;
}

function getCoordsList(text, pattern) {
	var coordsList = text.match(pattern);
	return coordsList;
}

function suffixToPrefix(coord) {
	suffix = coord.charAt(coord.length - 1);
	coordWithoutSuffix = coord.slice(0, coord.length - 1);
	coordPrefix = suffix + coordWithoutSuffix;
	return coordPrefix;
}

function getPrefixLatLonCoordsList(suffixCoordList) {
	var prefixCoords = [];
	var i;
	for (i = 0; i < suffixCoordList.length; i++) {
		lat = suffixCoordList[i].slice(0, 5);
		lon = suffixCoordList[i].slice(5);
		prefixLat = suffixToPrefix(lat);
		prefixLon = suffixToPrefix(lon);
		prefixCoord = prefixLat + " " + prefixLon;
		prefixCoords.push(prefixCoord);
	}
	return prefixCoords;
}

function getPrefixLatSpaceLonCoordsList(suffixCoordList) {
	var prefixCoords = [];
	var i;
	for (i = 0; i < suffixCoordList.length; i++) {
		coordPair = suffixCoordList[i].split(' ');
		lat = coordPair[0];
		lon = coordPair[1];
		prefixLat = suffixToPrefix(lat);
		prefixLon = suffixToPrefix(lon);
		prefixCoord = prefixLat + " " + prefixLon;
		prefixCoords.push(prefixCoord);
	}
	return prefixCoords;
}

function getPrefixCoordsList(suffixCoordsList, pattern) {
	var prefixCoordsList = [];
	if (pattern == patternLatSpaceLon) {
		prefixCoordsList = getPrefixLatSpaceLonCoordsList(suffixCoordsList);
	} else if (pattern == patternLatLon) {
		prefixCoordsList = getPrefixLatLonCoordsList(suffixCoordsList);
	}
	return prefixCoordsList;
}

function getFormattedCoords(coordsList) {
	var text = "";
	var i;
	for (i = 0; i < coordsList.length; i++) {
		text += coordsList[i] + "\n";
	}
	return text;
}

function extractCoordinates() {

  var inputText, selectedPattern;
  var suffixCoordsList = [], prefixCoordsList = [];

  document.getElementById("outputText").value = "";
  inputText = getInputText();
  selectedPattern = getCoordPattern();
  suffixCoordsList = getCoordsList(inputText, selectedPattern);
  prefixCoordsList = getPrefixCoordsList(suffixCoordsList, selectedPattern);
  document.getElementById("outputText").value = getFormattedCoords(prefixCoordsList);
}

</script>

</body>
</html>
